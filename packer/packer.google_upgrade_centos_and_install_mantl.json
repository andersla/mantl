{
  "variables": {
    "blabla": "",
    "blabla2": ""
  },
  "builders": [{
         "type": "googlecompute",
         "account_file": "/home/anders/projekt/phenomenal/google_cloud/AndersPhenoPack-84fa727872ae.json",
         "project_id": "andersphenopack",
         "source_image": "centos-7-v20160119",
         "zone": "europe-west1-b",
         "ssh_username": "centos",
         "ssh_pty" : "true",
	     "image_name": "phenomenal-installed-packaged"

    }],
  "provisioners": [
  
        {
            "type": "shell",
            "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E bash '{{.Path}}'",
            "scripts": [
                "{{pwd}}/packer/scripts/ansible.sh"
            ]
        },
		{
	        "type": "ansible-local",
	        "playbook_dir": "{{pwd}}/playbooks",
	        "playbook_file": "{{pwd}}/playbooks/upgrade-packages.yml"
	    },    
	    { 
	        "type": "shell",
		    "inline": ["sudo reboot -h now"]
		},
		{
		    "type": "shell",
            "pause_before": "10s",
            "start_retry_timeout": "15m",
		    "inline": ["echo $(date) > /tmp/rebooted"]
	    },
		{
            "type": "shell",
            "inline": ["mkdir /tmp/packer-provisioner-ansible-local/library"]
        },
        {
            "type": "ansible-local",
            "playbook_dir": "{{pwd}}/playbooks",
            "playbook_file": "{{pwd}}/phenomenal.yml",
            "role_paths": [
                "{{pwd}}/roles/calico",
                "{{pwd}}/roles/chronos",
                "{{pwd}}/roles/collectd",
                "{{pwd}}/roles/common",
                "{{pwd}}/roles/consul",
                "{{pwd}}/roles/consul-template",
                "{{pwd}}/roles/dnsmasq",
                "{{pwd}}/roles/docker",
                "{{pwd}}/roles/etcd",
                "{{pwd}}/roles/glusterfs",
                "{{pwd}}/roles/handlers",
                "{{pwd}}/roles/haproxy",
                "{{pwd}}/roles/logrotate",
                "{{pwd}}/roles/logstash",
                "{{pwd}}/roles/lvm",
                "{{pwd}}/roles/mantlui",
                "{{pwd}}/roles/marathon",
                "{{pwd}}/roles/mesos",
                "{{pwd}}/roles/nginx",
                "{{pwd}}/roles/traefik",
                "{{pwd}}/roles/vault",
                "{{pwd}}/roles/zookeeper"
            ],
            "extra_arguments": [ "--tags", "packaging,always_tag", "--extra-vars=\"provider=google\"" ],
            "inventory_groups": "role=edge,role=control,role=worker"
        }
    ]
    
}
